# CONTROL LAW PARAMETERS - NORMAL LAW
# ATA-27 Flight Controls - Gain Schedules and Control Parameters

version: 1.0
last_updated: 2025-01-15
system: ATA-27_FLIGHT_CONTROLS
subsystem: Flight Control Computer - Normal Law
description: Control law gains, schedules, and tuning parameters
dal_level: DAL-A
tuning_date: 2024-12-10
validation_status: Flight-tested and certified

# Related Documents
references:
  requirements: ../SPEC/control_modes.md
  signals: ../INTERFACES/signals.yaml
  test_vectors: ../TESTS/VECTORS/
  configuration: ../../../../CONFIGURATION_BASE/ATA-27_FLIGHT_CONTROLS/

# ==============================================================================
# PITCH AXIS CONTROL GAINS (Load Factor Command Mode)
# ==============================================================================

pitch_control:
  description: Pitch control law in Normal Law (load factor command)
  
  # Control law: elevator_cmd = K_pitch*(n_z_cmd - n_z_actual) + K_q*q_rate + K_alpha*alpha_trim
  
  baseline_gains:
    K_pitch:
      value: 15.0
      unit: deg_per_g
      description: Load factor tracking gain
      tuning_rationale: Provides 2-second rise time at cruise
      
    K_q:
      value: 2.5
      unit: deg_per_deg_per_sec
      description: Pitch rate damping gain
      tuning_rationale: Achieves 45 deg phase margin
      
    K_alpha:
      value: 0.8
      unit: deg_per_deg
      description: Angle of attack trim compensation
      tuning_rationale: Compensates for speed variations
      
  # Gain scheduling based on dynamic pressure
  gain_schedule_vs_dynamic_pressure:
    description: Gains vary with dynamic pressure (q) for consistent handling
    schedule_parameter: dynamic_pressure_psf
    interpolation_method: linear
    
    schedule_points:
      # Low speed (takeoff/landing)
      - dynamic_pressure_psf: 50
        K_pitch: 22.0
        K_q: 3.5
        K_alpha: 1.2
        flight_condition: Low speed, high AoA
        
      # Mid speed (climb/descent)
      - dynamic_pressure_psf: 150
        K_pitch: 15.0
        K_q: 2.5
        K_alpha: 0.8
        flight_condition: Mid speed
        
      # Cruise
      - dynamic_pressure_psf: 300
        K_pitch: 12.0
        K_q: 2.0
        K_alpha: 0.6
        flight_condition: Cruise, high q
        
      # High speed
      - dynamic_pressure_psf: 500
        K_pitch: 10.0
        K_q: 1.8
        K_alpha: 0.5
        flight_condition: High speed descent
        
  # CG position compensation
  cg_compensation:
    description: Adjust gains based on center of gravity position
    schedule_parameter: cg_position_percent_mac
    
    schedule_points:
      # Forward CG (more stable, less sensitive)
      - cg_percent_mac: 15
        gain_multiplier: 1.15
        description: Increase gains for forward CG
        
      # Mid CG (baseline)
      - cg_percent_mac: 25
        gain_multiplier: 1.0
        description: Baseline gains
        
      # Aft CG (less stable, more sensitive)
      - cg_percent_mac: 35
        gain_multiplier: 0.85
        description: Reduce gains for aft CG stability
        
  # Configuration-dependent gains
  configuration_gains:
    CLEAN:
      gain_multiplier: 1.0
      description: Baseline (cruise configuration)
      
    FLAPS_5:
      gain_multiplier: 1.05
      description: Slightly increased authority
      
    FLAPS_15:
      gain_multiplier: 1.15
      description: Takeoff/approach configuration
      
    FLAPS_30:
      gain_multiplier: 1.25
      description: Landing configuration, lower speed
      
  # Rate and position limits
  limits:
    max_elevator_deflection_deg: 25.0
    min_elevator_deflection_deg: -15.0
    max_elevator_rate_deg_per_sec: 40.0
    max_load_factor_cmd_g: 2.5
    min_load_factor_cmd_g: -1.0
    
  # Anti-windup
  anti_windup:
    enabled: true
    method: integrator_clamping
    clamp_threshold_deg: 0.8  # Clamp when within 80% of limit

# ==============================================================================
# ROLL AXIS CONTROL GAINS (Bank Angle Command Mode)
# ==============================================================================

roll_control:
  description: Roll control law in Normal Law (bank angle command)
  
  # Control law: aileron_cmd = K_bank*(phi_cmd - phi_actual) + K_p*p_rate
  
  baseline_gains:
    K_bank:
      value: 1.2
      unit: deg_aileron_per_deg_bank
      description: Bank angle tracking gain
      tuning_rationale: Provides 3-second bank angle capture
      
    K_p:
      value: 0.5
      unit: deg_per_deg_per_sec
      description: Roll rate damping gain
      tuning_rationale: Optimizes dutch roll damping
      
  # Gain scheduling
  gain_schedule_vs_dynamic_pressure:
    schedule_parameter: dynamic_pressure_psf
    
    schedule_points:
      - dynamic_pressure_psf: 50
        K_bank: 1.8
        K_p: 0.7
        
      - dynamic_pressure_psf: 150
        K_bank: 1.2
        K_p: 0.5
        
      - dynamic_pressure_psf: 300
        K_bank: 0.9
        K_p: 0.4
        
      - dynamic_pressure_psf: 500
        K_bank: 0.7
        K_p: 0.35
        
  # Aileron-rudder interconnect (ARI)
  aileron_rudder_interconnect:
    enabled: true
    K_ari: 0.15
    description: Rudder deflection per degree aileron for turn coordination
    
  # Limits
  limits:
    max_aileron_deflection_deg: 20.0
    min_aileron_deflection_deg: -20.0
    max_aileron_rate_deg_per_sec: 50.0
    max_bank_angle_normal_deg: 30.0
    max_bank_angle_override_deg: 67.0
    max_roll_rate_deg_per_sec: 15.0

# ==============================================================================
# YAW AXIS CONTROL GAINS (Turn Coordination)
# ==============================================================================

yaw_control:
  description: Automatic turn coordination in Normal Law
  
  # Control law: rudder_cmd = K_beta*beta + K_r*r_rate + K_turn*turn_compensation
  
  baseline_gains:
    K_beta:
      value: 2.0
      unit: deg_rudder_per_deg_sideslip
      description: Sideslip angle coordination gain
      tuning_rationale: Nulls lateral acceleration in turns
      
    K_r:
      value: 0.8
      unit: deg_per_deg_per_sec
      description: Yaw rate damping gain
      tuning_rationale: Dutch roll damping
      
    K_turn:
      value: 0.3
      unit: dimensionless
      description: Coordinated turn feedforward gain
      tuning_rationale: Anticipatory coordination based on bank angle
      
  # Gain scheduling
  gain_schedule_vs_dynamic_pressure:
    schedule_parameter: dynamic_pressure_psf
    
    schedule_points:
      - dynamic_pressure_psf: 50
        K_beta: 3.0
        K_r: 1.2
        K_turn: 0.45
        
      - dynamic_pressure_psf: 150
        K_beta: 2.0
        K_r: 0.8
        K_turn: 0.3
        
      - dynamic_pressure_psf: 300
        K_beta: 1.5
        K_r: 0.6
        K_turn: 0.2
        
  # Limits
  limits:
    max_rudder_deflection_deg: 25.0
    min_rudder_deflection_deg: -25.0
    max_rudder_rate_deg_per_sec: 35.0
    max_sideslip_angle_deg: 10.0

# ==============================================================================
# ENVELOPE PROTECTION PARAMETERS
# ==============================================================================

envelope_protection:
  description: Flight envelope protection limits and gains
  
  alpha_protection:
    warning_threshold_deg: 12.0
    protection_threshold_deg: 15.0
    hard_limit_deg: 18.0
    
    protection_gains:
      K_alpha_prot: 5.0
      description: Nose-down command gain when protection active
      
    hysteresis_deg: 2.0
    description: Deactivate protection at 2 deg below activation threshold
    
  load_factor_protection:
    max_positive_g: 2.5
    max_negative_g: -1.0
    soft_limit_margin_g: 0.2
    
    protection_gains:
      K_load_prot: 3.0
      description: Command limiting gain near load factor limits
      
  overspeed_protection:
    V_MO_kts: 330
    warning_margin_kts: 10
    protection_threshold_kts: 5
    
    protection_gains:
      K_overspeed_prot: 2.0
      description: Nose-up command gain when overspeed protection active
      
  bank_angle_protection:
    normal_limit_deg: 30.0
    override_limit_deg: 67.0
    
    protection_gains:
      K_bank_prot: 1.5
      description: Bank angle limiting gain

# ==============================================================================
# SENSOR FUSION AND FILTERING
# ==============================================================================

sensor_fusion:
  description: Kalman filter parameters for state estimation
  
  pitch_rate_estimator:
    process_noise: 0.01
    measurement_noise: 0.05
    initial_covariance: 1.0
    
  roll_rate_estimator:
    process_noise: 0.01
    measurement_noise: 0.05
    initial_covariance: 1.0
    
  angle_of_attack_fusion:
    method: triple_sensor_voting_with_kalman
    outlier_threshold: 5.0  # degrees
    process_noise: 0.02
    measurement_noise: 0.1
    
signal_filtering:
  description: Low-pass filter parameters for noise rejection
  
  pilot_input_filter:
    type: second_order_butterworth
    cutoff_frequency_hz: 8.0
    description: Smooth pilot commands
    
  rate_gyro_filter:
    type: second_order_butterworth
    cutoff_frequency_hz: 15.0
    description: Filter high-frequency noise
    
  air_data_filter:
    type: first_order_lowpass
    time_constant_sec: 0.5
    description: Smooth airspeed and altitude

# ==============================================================================
# ACTUATOR COMPENSATION
# ==============================================================================

actuator_compensation:
  description: Compensate for actuator dynamics and non-linearities
  
  elevator_actuator:
    model: second_order_plus_deadtime
    natural_frequency_hz: 12.0
    damping_ratio: 0.7
    deadtime_ms: 15
    
    compensation:
      type: feedforward
      enabled: true
      description: Phase lead compensation for actuator lag
      
  aileron_actuator:
    model: second_order_plus_deadtime
    natural_frequency_hz: 15.0
    damping_ratio: 0.7
    deadtime_ms: 12
    
  rudder_actuator:
    model: second_order_plus_deadtime
    natural_frequency_hz: 10.0
    damping_ratio: 0.8
    deadtime_ms: 18

# ==============================================================================
# VALIDATION AND CERTIFICATION
# ==============================================================================

validation:
  stability_margins:
    gain_margin_db: 8.5
    phase_margin_deg: 52.0
    validation_method: Frequency domain analysis
    
  robustness:
    gain_uncertainty_percent: ±20
    parameter_uncertainty_percent: ±15
    validation_method: Monte Carlo simulation (10000 runs)
    
  handling_qualities:
    cooper_harper_rating: Level 1 (target)
    validation_method: Flight test with evaluation pilots

certification:
  standard: DO-178C (DAL-A)
  software_version: FCC_v2.1.0
  authority: EASA / FAA
  approval_date: 2025-01-10
  
  traceability:
    requirements: All gains traced to REQ-FCC-xxx
    test_coverage: 100% of parameter ranges tested
    
# ==============================================================================
# UPDATE AND TUNING POLICY
# ==============================================================================

update_policy:
  method: Over-the-air software update (approved only)
  approval_required: Chief Engineer + Flight Test Lead + Certification Authority
  validation_required: Full HIL regression + flight test validation
  rollback_capability: true
  
tuning_policy:
  frequency: After significant design change, NCR, or flight anomaly
  methodology: |
    1. System identification from flight test data
    2. Control design optimization (LQR/H-infinity)
    3. Simulation validation (SIL/HIL)
    4. Flight test validation
  documentation: Tuning report filed in configuration management
  approval: Engineering Change Request (ECR) required

# ==============================================================================
# CHANGE HISTORY
# ==============================================================================

change_log:
  - version: 1.0
    date: 2025-01-15
    author: Flight Controls Engineering
    description: Initial parameter set for Normal Law control
    ecr_reference: ECR-2025-001
    ccb_approval: 2025-01-10
    flight_test_validation: FT-2024-045, FT-2024-052
